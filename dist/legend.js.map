{"version":3,"sources":["../src/legend.js"],"names":["angular","kbn","$","module","directive","popoverSrv","$timeout","link","scope","elem","firstRender","ctrl","panel","data","seriesList","i","events","on","series","color","render","getSeriesIndexForElement","el","parents","toggleSeries","e","currentTarget","index","seriesInfo","openColorSelector","target","length","show","element","position","template","openOn","model","autoClose","toggleAxis","colorSelected","changeSeriesColor"],"mappings":";;;;;;;;AAAOA,a;;AAEAC,S;;AACAC,O;;;AAFP;AAMAF,cAAQG,MAAR,CAAe,oBAAf,EAAqCC,SAArC,CAA+C,gBAA/C,EAAiE,UAASC,UAAT,EAAqBC,QAArB,EAA+B;AAC9F,eAAO;AACLC,gBAAM,cAASC,KAAT,EAAgBC,IAAhB,EAAsB;AAC1B;AACA,gBAAIC,cAAc,IAAlB;AACA,gBAAIC,OAAOH,MAAMG,IAAjB;AACA,gBAAIC,QAAQD,KAAKC,KAAjB;AACA,gBAAIC,IAAJ;AACA,gBAAIC,UAAJ;AACA,gBAAIC,CAAJ;AACA;;AAEAJ,iBAAKK,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,YAAW;AAClCJ,qBAAOF,KAAKO,MAAZ;AACA,kBAAIL,IAAJ,EAAU;AACR,qBAAI,IAAIE,CAAR,IAAaF,IAAb,EAAmB;AACjBA,uBAAKE,CAAL,EAAQI,KAAR,GAAgBR,KAAKE,IAAL,CAAUE,CAAV,EAAaI,KAA7B;AACD;AACDC;AACD;AACF,aARD;;AAUA,qBAASC,wBAAT,CAAkCC,EAAlC,EAAsC;AACpC,qBAAOA,GAAGC,OAAH,CAAW,qBAAX,EAAkCV,IAAlC,CAAuC,cAAvC,CAAP;AACD;;AAED,qBAASW,YAAT,CAAsBC,CAAtB,EAAyB;AACvB,kBAAIH,KAAKpB,EAAEuB,EAAEC,aAAJ,CAAT;AACA,kBAAIC,QAAQN,yBAAyBC,EAAzB,CAAZ;AACA,kBAAIM,aAAad,WAAWa,KAAX,CAAjB;AACAhB,mBAAKa,YAAL,CAAkBI,UAAlB,EAA8BH,CAA9B;AACD;;AAED,qBAASI,iBAAT,CAA2BJ,CAA3B,EAA8B;AAC5B;AACA,kBAAIvB,EAAEuB,EAAEK,MAAJ,EAAYP,OAAZ,CAAoB,UAApB,EAAgCQ,MAApC,EAA4C;AAC1C;AACD;;AAED,kBAAIT,KAAKpB,EAAEuB,EAAEC,aAAJ,CAAT,CAN4B,CAMC;;AAE7B,kBAAIC,QAAQN,yBAAyBC,EAAzB,CAAZ;AACA,kBAAIJ,SAASJ,WAAWa,KAAX,CAAb;;AAEArB,uBAAS,YAAW;AAClBD,2BAAW2B,IAAX,CAAgB;AACdC,2BAASX,GAAG,CAAH,CADK;AAEdY,4BAAU,eAFI;AAGdC,4BAAU,qCAHI;AAIdC,0BAAQ,OAJM;AAKdC,yBAAO;AACLC,+BAAW,IADN;AAELpB,4BAAQA,MAFH;AAGLqB,gCAAY,sBAAW,CAAE,CAHpB;AAILC,mCAAe,uBAASrB,KAAT,EAAgB;AAC7BR,2BAAK8B,iBAAL,CAAuBvB,MAAvB,EAA+BC,KAA/B;AACD;AANI;AALO,iBAAhB;AAcD,eAfD;AAgBD;;AAED,qBAASC,MAAT,GAAkB;;AAEhB,kBAAIV,WAAJ,EAAiB;AACf;AACAR,kBAAE,eAAF,EAAmBe,EAAnB,CAAsB,OAAtB,EAA+BY,iBAA/B;AACA;AACAnB,8BAAc,KAAd;AACD;;AAEDI,2BAAaD,IAAb;AACD;AACF;AAxEI,SAAP;AA0ED,OA3ED","file":"legend.js","sourcesContent":["import angular from 'angular';\n//import _ from  'lodash';\nimport kbn from 'app/core/utils/kbn';\nimport $ from  'jquery';\nimport 'jquery.flot';\nimport 'jquery.flot.time';\n\nangular.module('grafana.directives').directive('progressLegend', function(popoverSrv, $timeout) {\n  return {\n    link: function(scope, elem) {\n      // var $container = $('<section class=\"graph-legend\"></section>');\n      var firstRender = true;\n      var ctrl = scope.ctrl;\n      var panel = ctrl.panel;\n      var data;\n      var seriesList;\n      var i;\n      debugger;\n\n      ctrl.events.on('render', function() {\n        data = ctrl.series;\n        if (data) {\n          for(var i in data) {\n            data[i].color = ctrl.data[i].color;\n          }\n          render();\n        }\n      });\n\n      function getSeriesIndexForElement(el) {\n        return el.parents('[data-series-index]').data('series-index');\n      }\n\n      function toggleSeries(e) {\n        var el = $(e.currentTarget);\n        var index = getSeriesIndexForElement(el);\n        var seriesInfo = seriesList[index];\n        ctrl.toggleSeries(seriesInfo, e);\n      }\n\n      function openColorSelector(e) {\n        // if we clicked inside poup container ignore click\n        if ($(e.target).parents('.popover').length) {\n          return;\n        }\n\n        var el = $(e.currentTarget); //.find('.fa-minus');\n\n        var index = getSeriesIndexForElement(el);\n        var series = seriesList[index];\n\n        $timeout(function() {\n          popoverSrv.show({\n            element: el[0],\n            position: 'bottom center',\n            template: '<gf-color-picker></gf-color-picker>',\n            openOn: 'hover',\n            model: {\n              autoClose: true,\n              series: series,\n              toggleAxis: function() {},\n              colorSelected: function(color) {\n                ctrl.changeSeriesColor(series, color);\n              }\n            },\n          });\n        });\n      }\n\n      function render() {\n\n        if (firstRender) {\n          // elem.append($container);\n          $('.progress-bar').on('click', openColorSelector);\n          // $container.on('click', 'th', sortLegend);\n          firstRender = false;\n        }\n\n        seriesList = data;\n      }\n    }\n  };\n});\n"]}